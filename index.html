<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#166534">
  <title>Red 7 Card Counting Trainer</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }
    input {
      -webkit-user-select: text;
      user-select: text;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Icon components
    const PlayIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polygon points="5 3 19 12 5 21 5 3"></polygon>
      </svg>
    );

    const PauseIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="6" y="4" width="4" height="16"></rect>
        <rect x="14" y="4" width="4" height="16"></rect>
      </svg>
    );

    const RotateCcwIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="1 4 1 10 7 10"></polyline>
        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
      </svg>
    );

    const SettingsIcon = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m-9-9h6m6 0h6"></path>
        <path d="m4.93 4.93 4.24 4.24m5.66 0 4.24-4.24m0 14.14-4.24-4.24m-5.66 0-4.24 4.24"></path>
      </svg>
    );

    const XIcon = () => (
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    function Red7CardCountingTrainer() {
      const [isPlaying, setIsPlaying] = useState(false);
      const [speed, setSpeed] = useState(2000);
      const [deckCount, setDeckCount] = useState(6);
      const [playerCount, setPlayerCount] = useState(3);
      const [showSettings, setShowSettings] = useState(false);
      
      const [shoe, setShoe] = useState([]);
      const [currentCardIndex, setCurrentCardIndex] = useState(0);
      const [trueCount, setTrueCount] = useState(0);
      const [userCount, setUserCount] = useState('');
      const [cardsDealt, setCardsDealt] = useState(0);
      const [accuracy, setAccuracy] = useState({ correct: 0, total: 0 });
      const [showFeedback, setShowFeedback] = useState(false);
      const [isCorrect, setIsCorrect] = useState(false);
      
      const [currentHands, setCurrentHands] = useState([]);
      const intervalRef = useRef(null);

      useEffect(() => {
        initializeShoe();
      }, [deckCount]);

      const initializeShoe = () => {
        const suits = ['♠', '♣', '♥', '♦'];
        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        const newShoe = [];
        
        for (let d = 0; d < deckCount; d++) {
          for (let suit of suits) {
            for (let rank of ranks) {
              newShoe.push({ rank, suit });
            }
          }
        }
        
        // Shuffle
        for (let i = newShoe.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [newShoe[i], newShoe[j]] = [newShoe[j], newShoe[i]];
        }
        
        setShoe(newShoe);
        setCurrentCardIndex(0);
        setTrueCount(0);
        setCardsDealt(0);
        setCurrentHands(Array(playerCount).fill(null).map(() => []));
      };

      const getCardValue = (card) => {
        if (['2', '3', '4', '5', '6'].includes(card.rank)) return 1;
        if (card.rank === '7' && (card.suit === '♥' || card.suit === '♦')) return 1;
        if (['10', 'J', 'Q', 'K', 'A'].includes(card.rank)) return -1;
        return 0;
      };

      const dealNextCard = () => {
        if (currentCardIndex >= shoe.length) {
          setIsPlaying(false);
          return;
        }

        const card = shoe[currentCardIndex];
        const cardValue = getCardValue(card);
        
        const playerIndex = Math.floor(Math.random() * playerCount);
        setCurrentHands(prev => {
          const newHands = [...prev];
          newHands[playerIndex] = [...(newHands[playerIndex] || []), card];
          return newHands;
        });
        
        setTrueCount(prev => prev + cardValue);
        setCurrentCardIndex(prev => prev + 1);
        setCardsDealt(prev => prev + 1);
      };

      useEffect(() => {
        if (isPlaying) {
          intervalRef.current = setInterval(dealNextCard, speed);
        } else {
          if (intervalRef.current) clearInterval(intervalRef.current);
        }
        
        return () => {
          if (intervalRef.current) clearInterval(intervalRef.current);
        };
      }, [isPlaying, speed, currentCardIndex, shoe, playerCount]);

      const checkCount = () => {
        const userValue = parseInt(userCount);
        if (isNaN(userValue)) return;
        
        const correct = userValue === trueCount;
        setIsCorrect(correct);
        setShowFeedback(true);
        setAccuracy(prev => ({
          correct: prev.correct + (correct ? 1 : 0),
          total: prev.total + 1
        }));
        
        setTimeout(() => {
          setShowFeedback(false);
          setUserCount('');
        }, 1500);
      };

      const reset = () => {
        setIsPlaying(false);
        initializeShoe();
        setUserCount('');
        setShowFeedback(false);
        setAccuracy({ correct: 0, total: 0 });
      };

      const getCardColor = (suit) => {
        return (suit === '♥' || suit === '♦') ? 'text-red-600' : 'text-gray-900';
      };

      const decksRemaining = ((shoe.length - currentCardIndex) / 52).toFixed(1);
      const accuracyPercent = accuracy.total > 0 
        ? ((accuracy.correct / accuracy.total) * 100).toFixed(1) 
        : 0;

      return (
        <div className="min-h-screen bg-gradient-to-br from-green-800 to-green-900 p-4">
          <div className="max-w-md mx-auto">
            {/* Header */}
            <div className="bg-white rounded-t-2xl p-4 shadow-lg">
              <div className="flex justify-between items-center">
                <h1 className="text-2xl font-bold text-gray-900">Red 7 Trainer</h1>
                <button
                  onClick={() => setShowSettings(!showSettings)}
                  className="p-2 hover:bg-gray-100 rounded-lg transition-colors"
                >
                  {showSettings ? <XIcon /> : <SettingsIcon />}
                </button>
              </div>
              
              {/* Stats */}
              <div className="grid grid-cols-3 gap-2 mt-3 text-center">
                <div className="bg-gray-50 rounded-lg p-2">
                  <div className="text-xs text-gray-600">Cards</div>
                  <div className="text-lg font-bold">{cardsDealt}</div>
                </div>
                <div className="bg-gray-50 rounded-lg p-2">
                  <div className="text-xs text-gray-600">Decks Left</div>
                  <div className="text-lg font-bold">{decksRemaining}</div>
                </div>
                <div className="bg-gray-50 rounded-lg p-2">
                  <div className="text-xs text-gray-600">Accuracy</div>
                  <div className="text-lg font-bold">{accuracyPercent}%</div>
                </div>
              </div>
            </div>

            {/* Settings Panel */}
            {showSettings && (
              <div className="bg-white border-t border-gray-200 p-4">
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Speed: {(speed / 1000).toFixed(1)}s per card
                    </label>
                    <input
                      type="range"
                      min="500"
                      max="5000"
                      step="100"
                      value={speed}
                      onChange={(e) => setSpeed(parseInt(e.target.value))}
                      className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    />
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                      <span>0.5s (Fast)</span>
                      <span>5s (Slow)</span>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Shoe Size
                    </label>
                    <div className="flex gap-2">
                      <button
                        onClick={() => { setDeckCount(6); reset(); }}
                        className={`flex-1 py-2 rounded-lg font-medium transition-colors ${
                          deckCount === 6 
                            ? 'bg-green-600 text-white' 
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        6 Decks
                      </button>
                      <button
                        onClick={() => { setDeckCount(8); reset(); }}
                        className={`flex-1 py-2 rounded-lg font-medium transition-colors ${
                          deckCount === 8 
                            ? 'bg-green-600 text-white' 
                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                        }`}
                      >
                        8 Decks
                      </button>
                    </div>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Players: {playerCount}
                    </label>
                    <input
                      type="range"
                      min="1"
                      max="6"
                      value={playerCount}
                      onChange={(e) => {
                        setPlayerCount(parseInt(e.target.value));
                        setCurrentHands(Array(parseInt(e.target.value)).fill(null).map(() => []));
                      }}
                      className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                    />
                  </div>
                </div>
              </div>
            )}

            {/* Playing Table */}
            <div className="bg-gradient-to-br from-green-700 to-green-800 p-6 min-h-[400px]">
              {/* Player Positions */}
              <div className="grid grid-cols-3 gap-4 mb-6">
                {Array.from({ length: playerCount }).map((_, idx) => (
                  <div key={idx} className="text-center">
                    <div className="text-xs text-green-200 mb-1">Player {idx + 1}</div>
                    <div className="bg-green-900 bg-opacity-30 rounded-lg p-2 min-h-[60px] flex flex-wrap gap-1 justify-center items-center">
                      {currentHands[idx]?.slice(-3).map((card, cardIdx) => (
                        <div 
                          key={cardIdx}
                          className={`bg-white rounded shadow-md px-2 py-1 text-sm font-bold ${getCardColor(card.suit)}`}
                        >
                          {card.rank}{card.suit}
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>

              {/* Count Input */}
              <div className="bg-white bg-opacity-90 rounded-xl p-4 backdrop-blur">
                <label className="block text-sm font-medium text-gray-700 mb-2">
                  What's the count?
                </label>
                <div className="flex gap-2">
                  <input
                    type="number"
                    value={userCount}
                    onChange={(e) => setUserCount(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && checkCount()}
                    placeholder="Enter count"
                    className="flex-1 px-4 py-3 border border-gray-300 rounded-lg text-lg font-bold text-center focus:ring-2 focus:ring-green-500 focus:border-transparent"
                  />
                  <button
                    onClick={checkCount}
                    disabled={!userCount}
                    className="px-6 py-3 bg-green-600 text-white rounded-lg font-bold hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                  >
                    Check
                  </button>
                </div>

                {showFeedback && (
                  <div className={`mt-3 p-3 rounded-lg text-center font-bold ${
                    isCorrect 
                      ? 'bg-green-100 text-green-800' 
                      : 'bg-red-100 text-red-800'
                  }`}>
                    {isCorrect ? '✓ Correct!' : `✗ Wrong - Count is ${trueCount}`}
                  </div>
                )}
              </div>
            </div>

            {/* Controls */}
            <div className="bg-white rounded-b-2xl p-4 shadow-lg">
              <div className="flex gap-2">
                <button
                  onClick={() => setIsPlaying(!isPlaying)}
                  className="flex-1 py-4 bg-green-600 text-white rounded-xl font-bold hover:bg-green-700 transition-colors flex items-center justify-center gap-2"
                >
                  {isPlaying ? (
                    <>
                      <PauseIcon />
                      Pause
                    </>
                  ) : (
                    <>
                      <PlayIcon />
                      Start
                    </>
                  )}
                </button>
                <button
                  onClick={reset}
                  className="px-6 py-4 bg-gray-600 text-white rounded-xl font-bold hover:bg-gray-700 transition-colors"
                >
                  <RotateCcwIcon />
                </button>
              </div>

              {/* Instructions */}
              <div className="mt-4 p-3 bg-gray-50 rounded-lg text-sm text-gray-700">
                <div className="font-bold mb-1">Red 7 System:</div>
                <div className="text-xs space-y-0.5">
                  <div>• 2-6: +1</div>
                  <div>• Red 7 (♥♦): +1 | Black 7 (♠♣): 0</div>
                  <div>• 8-9: 0</div>
                  <div>• 10-A: -1</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Red7CardCountingTrainer />);
  </script>
</body>
</html>
